version: 1.0.{build}
image: Visual Studio 2017
clone_folder: c:\solc-build
cache:
- C:\solc-build\boost_1_67_0-msvc-14.1-32.exe
- C:\solc-build\boost_1_67_0-msvc-14.1-64.exe
branches:
  only:
    - master
skip_tags: true

build_script:
  - set RELEASE_TITLE=%DATE:~10,4%-%DATE:~4,2%-%DATE:~7,2%
  - echo %RELEASE_TITLE%
  - git submodule update --init --recursive || exit
  - build-win.bat x64 || exit
  - build-win.bat x86 || exit
  - 7z a win-x64.zip %APPVEYOR_BUILD_FOLDER%/solidity/build-RelWithDebInfo-64/libsolc/RelWithDebInfo/solc.dll || exit
  - appveyor PushArtifact win-x64.zip
  - 7z a win-x86.zip %APPVEYOR_BUILD_FOLDER%/solidity/build-RelWithDebInfo-32/libsolc/RelWithDebInfo/solc.dll || exit
  - appveyor PushArtifact win-x86.zip
  - build-win.bat x64 Debug || exit
  - 7z a win-x64-debug.zip %APPVEYOR_BUILD_FOLDER%/solidity/build-Debug-64/libsolc/Debug/solc.dll || exit
  - 7z a win-x64-debug.zip %APPVEYOR_BUILD_FOLDER%/solidity/build-Debug-64/libsolc/Debug/solc.pdb || exit
  - appveyor PushArtifact win-x64-debug.zip

deploy:
  tag: $(RELEASE_TITLE)
  release: $(RELEASE_TITLE)
  description: Solc lib
  provider: GitHub
  auth_token:
    secure: 28Oe+p1iAuhqRSPD1+oChgzTr52yyjmA+0c64Ca8dCrlI2VHJ4dy+B40dZjF93on
  artifact: win-x64.zip,win-x86.zip,win-x64-debug.zip
  force_update: true
  draft: false
  prerelease: false
  on:
    branch: master